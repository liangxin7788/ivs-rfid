<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fun.business.sharon.biz.business.dao.ProductInfoMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.fun.business.sharon.biz.business.bean.ProductInfo">
        <id column="id" property="id" />
        <result column="product_type_id" property="productTypeId" />
        <result column="cn_name" property="cnName" />
        <result column="en_name" property="enName" />
        <result column="description" property="description" />
        <result column="model" property="model" />
        <result column="application" property="application" />
        <result column="create_at" property="createAt" />
        <result column="update_at" property="updateAt" />
        <association property="productType" javaType="com.fun.business.sharon.biz.business.bean.ProductType">
            <id column="pt_id" property="id" />
            <result column="pt_type_cn" property="typeCn" />
            <result column="pt_type_en" property="typeEn" />
            <result column="pt_create_at" property="createAt" />
            <result column="pt_update_at" property="updateAt" />
        </association>
        <association property="productPic" javaType="com.fun.business.sharon.biz.business.bean.ProductPic">
            <id column="pp_id" property="id" />
            <result column="pp_product_info_id" property="productInfoId" />
            <result column="pp_image_name" property="imageName" />
            <result column="pp_image_url" property="imageUrl" />
            <result column="pp_create_at" property="createAt" />
            <result column="pp_update_at" property="updateAt" />
        </association>
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, product_type_id, cn_name, en_name, description, model, application, create_at, update_at
    </sql>

    <select id="getProductListCount" resultType="int">
        select count(1) from product_info pi
        left join product_type pt on pi.product_type_id = pt.id
        <where>
            1 = 1
            <if test="vo.productTypeId != null">
                and pt.id = #{vo.productTypeId}
            </if>
            <if test="vo.productTitle != null and vo.productTitle != ''">
                and (pi.cn_name like concat('%', #{vo.productTitle}, '%') or pi.en_name like concat('%', #{vo.productTitle}, '%'))
            </if>
        </where>
    </select>

    <select id="getProductList" resultMap="BaseResultMap">
        select pi.*, pt.id pt_id, pt.type_cn pt_type_cn, pt.type_en pt_type_en, pt.create_at pt_create_at, pt.update_at pt_update_at,
        pp.id pp_id, pp.product_info_id pp_product_info_id, pp.image_name pp_image_name, pp.image_url pp_image_url,
        pp.create_at pp_create_at, pp.update_at pp_update_at
        from product_info pi
        left join product_type pt on pi.product_type_id = pt.id
        left join product_pic pp on pp.product_info_id = pi.id
        <where>
            1 = 1
            <if test="vo.productTypeId != null">
                and pt.id = #{vo.productTypeId}
            </if>
            <if test="vo.productTitle != null and vo.productTitle != ''">
                and (pi.cn_name like concat('%', #{vo.productTitle}, '%') or pi.en_name like concat('%', #{vo.productTitle}, '%'))
            </if>
        </where>
    </select>

</mapper>
